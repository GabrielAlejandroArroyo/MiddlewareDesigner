<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Middleware Designer - Orquestador</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <style>
        body { background-color: #f8f9fa; }
        .sidebar { background: #212529; min-height: 100vh; color: white; padding: 20px; position: fixed; width: 250px; }
        .content { margin-left: 270px; padding: 40px; }
        .nav-link { color: #adb5bd; }
        .nav-link:hover { color: white; }
        .nav-link.active { color: #0dcaf0; font-weight: bold; }
        pre { background: #212529; color: #f1f1f1; padding: 15px; border-radius: 8px; font-size: 0.9rem; }
        .feature-box { border-left: 4px solid #198754; background: white; padding: 15px; margin-bottom: 20px; border-radius: 0 8px 8px 0; }
    </style>
</head>
<body>
    <div class="sidebar">
        <h4 class="mb-4 text-info">MD Docs</h4>
        <ul class="nav flex-column">
            <li class="nav-item mb-2"><a class="nav-link" href="../index.html"><i class="bi bi-house-door me-2"></i>Inicio</a></li>
            <li class="nav-item mb-2"><a class="nav-link" href="../arquitectura/general.html"><i class="bi bi-diagram-3 me-2"></i>Arquitectura</a></li>
            <li class="nav-item mb-2"><a class="nav-link" href="../arquitectura/modelos_datos.html"><i class="bi bi-database me-2"></i>Modelos de Datos</a></li>
            <li class="nav-item mb-2"><a class="nav-link" href="../servicios/catalogo.html"><i class="bi bi-box me-2"></i>Servicios</a></li>
            <li class="nav-item mb-2"><a class="nav-link active" href="README.html"><i class="bi bi-cpu me-2"></i>Middleware</a></li>
            <li class="nav-item mb-2"><a class="nav-link" href="../frontend/README.html"><i class="bi bi-window me-2"></i>Frontend</a></li>
        </ul>
    </div>
    <div class="content">
        <h1 class="mb-4">Middleware - Orquestador Inteligente</h1>
        <p class="lead">El motor de resolución que transforma especificaciones técnicas en metadatos para la UI.</p>

        <h2 class="mt-5 mb-3 text-secondary">Lógica de Resolución Resiliente</h2>
        
        <div class="feature-box shadow-sm">
            <h6 class="fw-bold text-success"><i class="bi bi-layers me-2"></i>Aplanamiento de Herencia (allOf)</h6>
            <p class="mb-0 small text-muted">Combina recursivamente todas las propiedades de las clases base y derivadas, asegurando que campos heredados (como el ID) nunca se pierdan en la inspección.</p>
        </div>

        <div class="feature-box shadow-sm">
            <h6 class="fw-bold text-success"><i class="bi bi-shield-check me-2"></i>Manejo de anyOf / oneOf</h6>
            <p class="mb-0 small text-muted">Detecta y selecciona el tipo de dato principal en definiciones múltiples (ej: String | null), garantizando tipos consistentes para el diseñador.</p>
        </div>

        <div class="feature-box shadow-sm">
            <h6 class="fw-bold text-success"><i class="bi bi-magic me-2"></i>Sanitización Automática</h6>
            <p class="mb-0 small text-muted">Limpia metadatos (titles, descriptions) de caracteres no-ASCII y ruidos de codificación para evitar errores de parseo en el frontend.</p>
        </div>

        <h2 class="mt-5 mb-3 text-secondary">Gestión de Caché</h2>
        <p>El sistema implementa una política de <strong>Hard Reset</strong> mediante la limpieza de la base de datos central, obligando a los servicios a re-publicar sus contratos ante cambios estructurales.</p>
        <pre>UPDATE backend_services SET swagger_spec_cached = NULL, swagger_hash = NULL;</pre>

        <h2 class="mt-5 mb-3 text-secondary">Tecnologías</h2>
        <ul>
            <li><strong>FastAPI</strong>: Para el manejo asíncrono de peticiones.</li>
            <li><strong>SQLAlchemy 2.0</strong>: Con motor asíncrono para la persistencia de configuraciones.</li>
            <li><strong>OpenAPI 3.1 Parser</strong>: Motor propio de resolución recursiva de modelos.</li>
        </ul>
    </div>
</body>
</html>
